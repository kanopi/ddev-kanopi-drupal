#!/usr/bin/env bash

## Description: Apply a Drupal Recipe.
## Usage: recipe-apply <recipe-path>
## Example: ddev recipe-apply ../recipes/recipe-name
## Example: ddev recipe-apply core/recipes/standard
## Aliases: recipe:apply,recipe,ra

#ddev-generated

# Abort if anything fails
set -e

# Define the Drupal root inside DDEV
DOCROOT_PATH="/var/www/html/${DDEV_DOCROOT}"

# Ensure we're in the correct directory
cd "${DOCROOT_PATH}"

# Clear cache before applying the recipe
echo -e "\n üßπ  Clearing cache before applying recipe."
if command -v drush &> /dev/null; then
    drush cr
else
    echo "‚ö†Ô∏è  Drush not available, skipping cache clear"
fi

# Apply the recipe
echo -e "\n üì¶  Applying Drupal Recipe: $@"
php core/scripts/drupal recipe "$@"

# Clear cache again after applying the recipe
echo -e "\n üßπ  Clearing cache after applying recipe."
if command -v drush &> /dev/null; then
    drush cr
else
    echo "‚ö†Ô∏è  Drush not available, skipping cache clear"
fi

echo -e "\n ‚úÖ  Recipe applied successfully!\n"

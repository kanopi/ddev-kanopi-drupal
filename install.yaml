name: ddev-kanopi-pantheon-drupal

# Based on https://github.com/ddev/ddev/blob/HEAD/pkg/ddevapp/addons.go#L61
project_files:
- commands/
- providers/

# DDEV version constraint
ddev_version_constraint: ">= v1.22.0"

# Pre-install actions
pre_install_actions:
# Create the addon directory
- |
  #ddev-nodisplay
  #ddev-description:Installing Kanopi Pantheon Drupal Add-on

# Post-install actions
post_install_actions:
- |
  #ddev-nodisplay
  CONFIG_FILE=".ddev/config.yaml"
  if command -v yq >/dev/null 2>&1; then
    echo "üîß Adding Kanopi Pantheon environment variables to $CONFIG_FILE"
    yq eval '.web_environment += [
      "THEME=themes/custom/arbor",
      "THEMENAME=arbor",
      "hostingsite=your-pantheon-site",
      "hostingenv=dev",
      "MIGRATE_DB_SOURCE=pantheon_source_project",
      "MIGRATE_DB_ENV=live"
    ]' -i "$CONFIG_FILE"
  else
    echo "‚ö†Ô∏è 'yq' is not installed. Skipping web_environment config."
  fi

# Explain the installed components
- |
  echo ""
  echo "‚úÖ Kanopi Pantheon Drupal Add-on installed successfully!"
  echo ""
  echo "üì¶ Installed components:"
  echo "   ‚Ä¢ Enhanced Pantheon provider with smart backup management"
  echo "   ‚Ä¢ 17 custom commands for Drupal development workflow"
  echo "   ‚Ä¢ Theme development tools with Node.js/NPM support"
  echo "   ‚Ä¢ Cypress testing integration"
  echo "   ‚Ä¢ Drupal Recipe support"
  echo "   ‚Ä¢ Migration and backup utilities"
  echo ""
  echo "üîß Next steps:"
  echo "   1. Set your Pantheon machine token (if you haven't already):"
  echo "      ddev config global --web-environment-add=TERMINUS_MACHINE_TOKEN=your_token_here"
  echo "   2. Configure your Pantheon project in .ddev/providers/pantheon.yaml"
  echo "   3. Update environment variables in .ddev/config.yaml (theme paths, site names, etc.)"
  echo "   4. Run 'ddev restart' to apply changes"
  echo ""
  echo "üìö Run 'ddev help' to see available commands"
  echo ""

removal_action:
# Note what's being removed
- |
  echo "Removing Kanopi Pantheon Drupal Add-on..."

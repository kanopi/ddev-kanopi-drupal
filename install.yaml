name: ddev-kanopi-pantheon-drupal

# Based on https://github.com/ddev/ddev/blob/HEAD/pkg/ddevapp/addons.go#L61
project_files:
- commands/
- providers/

# DDEV version constraint 
ddev_version_constraint: ">= v1.22.0"

# Pre-install actions
pre_install_actions:
# Create the addon directory
- |
  #ddev-nodisplay
  #ddev-description:Installing Kanopi Pantheon Drupal Add-on

# Post-install actions  
post_install_actions:
# Add web environment variables to config.yaml if they don't exist
- |
  #ddev-nodisplay
  CONFIG_FILE=".ddev/config.yaml"
  if [ -f "$CONFIG_FILE" ]; then
    # Check if web_environment section already exists
    if ! grep -q "^web_environment:" "$CONFIG_FILE"; then
      echo "" >> "$CONFIG_FILE"
      echo "# Kanopi Pantheon Drupal Add-on environment variables" >> "$CONFIG_FILE"
      echo "web_environment:" >> "$CONFIG_FILE"
      echo "  # Theme development variables (update paths as needed)" >> "$CONFIG_FILE"
      echo "  - THEME=themes/custom/arbor" >> "$CONFIG_FILE"
      echo "  - THEMENAME=arbor" >> "$CONFIG_FILE"
      echo "  # Pantheon hosting variables" >> "$CONFIG_FILE"
      echo "  - hostingsite=your-pantheon-site" >> "$CONFIG_FILE"
      echo "  - hostingenv=dev" >> "$CONFIG_FILE"
      echo "  # Migration source variables (update if migrating)" >> "$CONFIG_FILE"
      echo "  - MIGRATE_DB_SOURCE=pantheon_source_project" >> "$CONFIG_FILE"
      echo "  - MIGRATE_DB_ENV=live" >> "$CONFIG_FILE"
    fi
  fi

# Explain the installed components
- |
  echo ""
  echo "âœ… Kanopi Pantheon Drupal Add-on installed successfully!"
  echo ""
  echo "ðŸ“¦ Installed components:"
  echo "   â€¢ Enhanced Pantheon provider with smart backup management"
  echo "   â€¢ 17 custom commands for Drupal development workflow"
  echo "   â€¢ Theme development tools with Node.js/NPM support"
  echo "   â€¢ Cypress testing integration"
  echo "   â€¢ Drupal Recipe support"
  echo "   â€¢ Migration and backup utilities"
  echo ""
  echo "ðŸ”§ Next steps:"
  echo "   1. Set your Pantheon machine token (if you haven't already):"
  echo "      ddev config global --web-environment-add=TERMINUS_MACHINE_TOKEN=your_token_here"
  echo "   2. Configure your Pantheon project in .ddev/providers/pantheon.yaml"
  echo "   3. Update environment variables in .ddev/config.yaml (theme paths, site names, etc.)"
  echo "   4. Run 'ddev restart' to apply changes"
  echo ""
  echo "ðŸ“š Run 'ddev help' to see available commands"
  echo ""

removal_action:
# Note what's being removed
- |
  echo "Removing Kanopi Pantheon Drupal Add-on..."
